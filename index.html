<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡¶¨‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶®‡¶ø‡¶∞ ‡¶ñ‡ßã‡¶Å‡¶ú‡ßá ‡¶Ü‡¶Æ‡¶∞‡¶æ</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js"></script>

<style>
body,html{
margin:0;
padding:0;
height:100%;
font-family:sans-serif;
}

header{
position:absolute;
top:0;
left:0;
width:100%;
background:#0f9d58;
color:white;
padding:15px;
text-align:center;
z-index:1000;
font-weight:bold;
}

#map{
height:100vh;
width:100%;
}

.floating-form{
position:absolute;
bottom:20px;
left:50%;
transform:translateX(-50%);
background:white;
padding:12px;
border-radius:12px;
box-shadow:0 4px 15px rgba(0,0,0,0.2);
width:90%;
max-width:400px;
z-index:1000;
}

input{
width:100%;
padding:6px;
margin:4px 0;
}

button{
padding:6px 10px;
border:none;
border-radius:6px;
background:#ff8c00;
color:white;
cursor:pointer;
margin-top:5px;
}
</style>
</head>

<body>

<header>üçΩ ‡¶¨‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶®‡¶ø‡¶∞ ‡¶ñ‡ßã‡¶Å‡¶ú‡ßá ‡¶Ü‡¶Æ‡¶∞‡¶æ</header>

<div id="map"></div>

<div class="floating-form">
<input type="text" id="name" placeholder="‡¶Æ‡¶∏‡¶ú‡¶ø‡¶¶‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ">
<input type="text" id="location" placeholder="‡¶è‡¶≤‡¶æ‡¶ï‡¶æ">
<button onclick="autoLocation()">Auto Location</button>
<button onclick="submitSpot()">Submit</button>
</div>

<script>

const firebaseConfig={
apiKey:"AIzaSyDnCP_Dc3ok6liqzK6j5BAgs0jKfr600Kc",
authDomain:"biryani-khoje-amra.firebaseapp.com",
databaseURL:"https://biryani-khoje-amra-default-rtdb.asia-southeast1.firebasedatabase.app/",
projectId:"biryani-khoje-amra"
};

firebase.initializeApp(firebaseConfig);
const db=firebase.database();

let userLat=23.8103;
let userLng=90.4125;

let map=L.map('map').setView([userLat,userLng],12);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
{attribution:'¬© OpenStreetMap'}).addTo(map);

function autoLocation(){
navigator.geolocation.getCurrentPosition(pos=>{
userLat=pos.coords.latitude;
userLng=pos.coords.longitude;
map.setView([userLat,userLng],15);
});
}

function submitSpot(){
db.ref("spots/pending").push({
name:name.value,
location:location.value,
lat:userLat,
lng:userLng
});
alert("Pending for approval");
}

function loadSpots(){
db.ref("spots/approved").on("value",snap=>{
const data=snap.val();

map.eachLayer(layer=>{
if(layer instanceof L.Marker) map.removeLayer(layer);
});

for(let key in data){
let spot=data[key];
let trueCount=spot.trueCount||0;
let fakeCount=spot.fakeCount||0;

let popupContent=`
<b>${spot.name}</b><br>
${spot.location}<br><br>
üëç ${trueCount} 
<button onclick="voteTrue('${key}')">Vote True</button><br><br>
‚ùå ${fakeCount} 
<button onclick="voteFake('${key}')">Vote Fake</button>
`;

L.marker([spot.lat,spot.lng]).addTo(map)
.bindPopup(popupContent);
}
});
}

function voteTrue(id){
db.ref("spots/approved/"+id+"/trueCount")
.transaction(c=>(c||0)+1);
}

function voteFake(id){
db.ref("spots/approved/"+id+"/fakeCount")
.transaction(c=>(c||0)+1);
}

loadSpots();

</script>

</body>
</html>