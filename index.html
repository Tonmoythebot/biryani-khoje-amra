<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡¶¨‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶®‡¶ø‡¶∞ ‡¶ñ‡ßã‡¶Å‡¶ú‡ßá ‡¶Ü‡¶Æ‡¶∞‡¶æ</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js"></script>

<style>
body{margin:0;font-family:'Segoe UI',sans-serif;background:#f4f6f9;}
header{background:linear-gradient(135deg,#0f9d58,#087f3f);
color:white;padding:20px;text-align:center;font-size:20px;font-weight:bold;}
.search-box{margin:-25px auto 10px auto;width:90%;background:white;
padding:12px;border-radius:15px;box-shadow:0 4px 12px rgba(0,0,0,0.1);
display:flex;gap:10px;}
.search-box input{flex:1;border:none;outline:none;font-size:14px;}
.search-box button{background:#ff8c00;border:none;color:white;
padding:8px 12px;border-radius:10px;cursor:pointer;}
#map{height:350px;width:100%;margin-top:10px;}
.card{background:white;margin:15px;padding:15px;border-radius:15px;
box-shadow:0 6px 15px rgba(0,0,0,0.08);transition:0.3s;}
.card:hover{transform:translateY(-3px);}
.vote-section{margin-top:8px;}
.vote-section button{margin-right:5px;background:#ff8c00;color:white;
border:none;padding:6px 10px;border-radius:8px;cursor:pointer;}
.verified{background:#0f9d58;color:white;padding:4px 8px;border-radius:8px;font-size:12px;}
.fakeWarn{background:#d93025;color:white;padding:4px 8px;border-radius:8px;font-size:12px;}
</style>
</head>

<body>

<header>üçΩ ‡¶¨‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶®‡¶ø‡¶∞ ‡¶ñ‡ßã‡¶Å‡¶ú‡ßá ‡¶Ü‡¶Æ‡¶∞‡¶æ</header>

<div class="search-box">
<input type="text" placeholder="‡¶è‡¶≤‡¶æ‡¶ï‡¶æ ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®...">
<button onclick="getLocation()">üìç Nearby</button>
<a href="admin.html">Admin</a>
</div>

<div id="map"></div>
<div id="spotList"></div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDnCP_Dc3ok6liqzK6j5BAgs0jKfr600Kc",
  authDomain: "biryani-khoje-amra.firebaseapp.com",
  databaseURL: "https://biryani-khoje-amra-default-rtdb.asia-southeast1.firebasedatabase.app/",
  projectId: "biryani-khoje-amra",
  storageBucket: "biryani-khoje-amra.firebasestorage.app",
  messagingSenderId: "755272589235",
  appId: "1:755272589235:web:83762f79622a749b8375c6"
};

firebase.initializeApp(firebaseConfig);
const database = firebase.database();

let map = L.map('map').setView([23.8103, 90.4125], 12);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
{attribution:'¬© OpenStreetMap contributors'}).addTo(map);

function getLocation(){
navigator.geolocation.getCurrentPosition(pos=>{
map.setView([pos.coords.latitude,pos.coords.longitude],14);
});
}

database.ref("spots").on("value",snap=>{
const data=snap.val();
document.getElementById("spotList").innerHTML="";
map.eachLayer(layer=>{if(layer instanceof L.Marker) map.removeLayer(layer);});

for(let key in data){
const spot=data[key];
const trueCount=spot.trueCount||0;
const fakeCount=spot.fakeCount||0;
const total=trueCount+fakeCount;
let badge="";
if(total>0){
let percent=(trueCount/total)*100;
if(percent>=70) badge=`<span class="verified">Verified</span>`;
else if(percent<50) badge=`<span class="fakeWarn">Suspicious</span>`;
}

L.marker([spot.lat,spot.lng]).addTo(map)
.bindPopup(`<b>${spot.name}</b><br>${spot.location}`);

document.getElementById("spotList").innerHTML+=`
<div class="card">
<h3>${spot.name}</h3>
<p>${spot.location}</p>
${badge}
<div class="vote-section">
<button onclick="voteTrue('${key}')">üëç ${trueCount}</button>
<button onclick="voteFake('${key}')">‚ùå ${fakeCount}</button>
</div>
</div>`;
}
});

function voteTrue(id){
database.ref("spots/"+id+"/trueCount")
.transaction(count=>(count||0)+1);
}
function voteFake(id){
database.ref("spots/"+id+"/fakeCount")
.transaction(count=>(count||0)+1);
}
</script>
</body>
</html>