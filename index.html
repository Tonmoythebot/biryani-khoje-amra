<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡¶¨‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶®‡¶ø‡¶∞ ‡¶ñ‡ßã‡¶Å‡¶ú‡ßá ‡¶Ü‡¶Æ‡¶∞‡¶æ</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js"></script>

<style>
body{margin:0;font-family:'Segoe UI',sans-serif;background:#f4f6f9;}
header{background:linear-gradient(135deg,#0f9d58,#087f3f);
color:white;padding:18px;text-align:center;font-size:18px;font-weight:bold;}
#map{height:300px;}
.container{padding:10px;}
.card{background:white;margin:10px 0;padding:12px;border-radius:12px;
box-shadow:0 4px 10px rgba(0,0,0,0.08);}
button{padding:6px 10px;border:none;border-radius:6px;background:#ff8c00;color:white;}
.badge{padding:4px 8px;border-radius:8px;font-size:12px;color:white;}
.verified{background:#0f9d58;}
.fake{background:#d93025;}
input{width:100%;padding:6px;margin:4px 0;}
</style>
</head>

<body>

<header>üçΩ ‡¶¨‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶®‡¶ø‡¶∞ ‡¶ñ‡ßã‡¶Å‡¶ú‡ßá ‡¶Ü‡¶Æ‡¶∞‡¶æ</header>

<div id="map"></div>

<div class="container">

<h3>üìç ‡¶®‡¶§‡ßÅ‡¶® Spot ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</h3>

<input type="text" id="name" placeholder="‡¶Æ‡¶∏‡¶ú‡¶ø‡¶¶‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ">
<input type="text" id="location" placeholder="‡¶è‡¶≤‡¶æ‡¶ï‡¶æ">

<input type="number" id="lat" placeholder="Latitude">
<input type="number" id="lng" placeholder="Longitude">

<button onclick="detectLocation()">Auto Detect</button>
<button onclick="submitSpot()">Submit</button>

<hr>

<h3>üìã Approved Spots</h3>
<div id="spotList"></div>

</div>

<script>

const firebaseConfig={
apiKey:"AIzaSyDnCP_Dc3ok6liqzK6j5BAgs0jKfr600Kc",
authDomain:"biryani-khoje-amra.firebaseapp.com",
databaseURL:"https://biryani-khoje-amra-default-rtdb.asia-southeast1.firebasedatabase.app/",
projectId:"biryani-khoje-amra"
};

firebase.initializeApp(firebaseConfig);
const db=firebase.database();

let map=L.map('map').setView([23.8103,90.4125],12);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
{attribution:'¬© OpenStreetMap'}).addTo(map);

function detectLocation(){
navigator.geolocation.getCurrentPosition(pos=>{
document.getElementById("lat").value=pos.coords.latitude;
document.getElementById("lng").value=pos.coords.longitude;
});
}

function submitSpot(){
db.ref("spots/pending").push({
name:name.value,
location:location.value,
lat:parseFloat(lat.value),
lng:parseFloat(lng.value)
});
alert("Pending for approval");
}

db.ref("spots/approved").on("value",snap=>{
const data=snap.val();
spotList.innerHTML="";
map.eachLayer(layer=>{if(layer instanceof L.Marker) map.removeLayer(layer);});
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

for(let key in data){
let spot=data[key];
let trueCount=spot.trueCount||0;
let fakeCount=spot.fakeCount||0;
let total=trueCount+fakeCount;
let badge="";

if(total>0){
let percent=(trueCount/total)*100;
if(percent>=70) badge=`<span class="badge verified">Verified</span>`;
else if(percent<50) badge=`<span class="badge fake">Suspicious</span>`;
}

L.marker([spot.lat,spot.lng]).addTo(map)
.bindPopup(`<b>${spot.name}</b><br>${spot.location}`);

spotList.innerHTML+=`
<div class="card">
<h4>${spot.name}</h4>
<p>${spot.location}</p>
${badge}
<br>
<button onclick="voteTrue('${key}')">üëç ${trueCount}</button>
<button onclick="voteFake('${key}')">‚ùå ${fakeCount}</button>
</div>`;
}
});

function voteTrue(id){
db.ref("spots/approved/"+id+"/trueCount")
.transaction(c=>(c||0)+1);
}
function voteFake(id){
db.ref("spots/approved/"+id+"/fakeCount")
.transaction(c=>(c||0)+1);
}

</script>
</body>
</html>