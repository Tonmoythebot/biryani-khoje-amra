<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡¶¨‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶®‡¶ø‡¶∞ ‡¶ñ‡ßã‡¶Å‡¶ú‡ßá ‡¶Ü‡¶Æ‡¶∞‡¶æ</title>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js"></script>

<style>
body,html{margin:0;padding:0;height:100%;font-family:sans-serif;}

header{
position:absolute;
top:0;
width:100%;
background:linear-gradient(135deg,#0f9d58,#087f3f);
color:white;
padding:15px;
text-align:center;
z-index:1000;
font-weight:bold;
}

#map{height:100vh;width:100%;}

.floating{
position:absolute;
bottom:20px;
left:50%;
transform:translateX(-50%);
background:white;
padding:12px;
border-radius:12px;
box-shadow:0 4px 20px rgba(0,0,0,0.3);
z-index:1000;
width:90%;
max-width:420px;
}

input{
width:100%;
padding:6px;
margin:4px 0;
}

button{
padding:6px 10px;
border:none;
border-radius:6px;
background:#ff8c00;
color:white;
margin-top:5px;
cursor:pointer;
}
</style>
</head>

<body>

<header>üçΩ ‡¶¨‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶®‡¶ø‡¶∞ ‡¶ñ‡ßã‡¶Å‡¶ú‡ßá ‡¶Ü‡¶Æ‡¶∞‡¶æ</header>
<div id="map"></div>

<div class="floating">
<input type="text" id="name" placeholder="‡¶Æ‡¶∏‡¶ú‡¶ø‡¶¶‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ">
<input type="text" id="location" placeholder="‡¶è‡¶≤‡¶æ‡¶ï‡¶æ">
<button onclick="autoLocation()">üìç Auto Location</button>
<button onclick="submitSpot()">Submit</button>
</div>

<script>

const firebaseConfig={
apiKey:"AIzaSyDnCP_Dc3ok6liqzK6j5BAgs0jKfr600Kc",
authDomain:"biryani-khoje-amra.firebaseapp.com",
databaseURL:"https://biryani-khoje-amra-default-rtdb.asia-southeast1.firebasedatabase.app/",
projectId:"biryani-khoje-amra"
};

firebase.initializeApp(firebaseConfig);
const db=firebase.database();

let map;
let userLat=23.8103;
let userLng=90.4125;

function initMap(){
map=new google.maps.Map(document.getElementById("map"),{
center:{lat:userLat,lng:userLng},
zoom:12
});
loadSpots();
}

function autoLocation(){
navigator.geolocation.getCurrentPosition(pos=>{
userLat=pos.coords.latitude;
userLng=pos.coords.longitude;
map.setCenter({lat:userLat,lng:userLng});
map.setZoom(15);
});
}

function submitSpot(){
db.ref("spots/pending").push({
name:name.value,
location:location.value,
lat:userLat,
lng:userLng
});
alert("Pending for approval");
}

function loadSpots(){
db.ref("spots/approved").on("value",snap=>{
const data=snap.val();
for(let key in data){

let spot=data[key];
let trueCount=spot.trueCount||0;
let fakeCount=spot.fakeCount||0;
let total=trueCount+fakeCount;
let color="green";

if(total>0){
let percent=(trueCount/total)*100;
if(percent<50) color="red";
}

let marker=new google.maps.Marker({
position:{lat:spot.lat,lng:spot.lng},
map:map,
icon:{
url:"http://maps.google.com/mapfiles/ms/icons/"+color+"-dot.png"
}
});

let content=`
<b>${spot.name}</b><br>
${spot.location}<br><br>
üëç ${trueCount} <button onclick="voteTrue('${key}')">Vote</button><br>
‚ùå ${fakeCount} <button onclick="voteFake('${key}')">Vote</button>
`;

let info=new google.maps.InfoWindow({content:content});
marker.addListener("click",()=>info.open(map,marker));
}
});
}

function voteTrue(id){
db.ref("spots/approved/"+id+"/trueCount")
.transaction(c=>(c||0)+1);
}

function voteFake(id){
db.ref("spots/approved/"+id+"/fakeCount")
.transaction(c=>(c||0)+1);
}

</script>

<script async defer
src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCSslPfCDshw6Y3dy9Ea9BOyI8HLRuKFgQ&callback=initMap">
</script>

</body>
</html>